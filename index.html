<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Play map locations as a slideshow</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <style>
    .map-overlay-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;

      /* 30% of the viewport height */
      background-color: rgba(0, 0, 0, 0.8);
      /* semi-transparent background */
      z-index: 1000;
      /* ensures it overlays other content */
      display: flex;
      align-items: center;
      justify-content: center;

      /*      
  color: white;
      position: absolute;
      width: 25%;
      top: 0;
      left: 0;
      padding: 10px;
      z-index: 1;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      */
    }

    .map-overlay {
      font:
        12px/20px 'Helvetica Neue',
        Arial,
        Helvetica,
        sans-serif;
      background-color: #fff;
      border-radius: 1em;
      padding: 1em;
      margin: 1em;
    }

    .map-overlay h2,
    .map-overlay p {
      margin: 0 0 10px;
    }
  </style>

  <div id="map"></div>

  <div class="map-overlay-container">
    <div class="map-overlay">
      <h1 id="location-title"></h1>
      <h3 id="landmarks"></h3>
      <p id="location-description"></p>
      <button onclick="nextDay()">Next Day</button><br />
      <small><a target="_blank" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTNw0e583X1cRLA4AZ16hERlCQ80CRZxfdx6vnaCN4kbLwWOxMPM4ZCv8f8xMjNDImd-IcPwE5bEGCN/pubhtml?gid=624153727&single=true">View full itinerary</a></small>
    </div>
  </div>

  <script>

    // Based on example: https://docs.mapbox.com/mapbox-gl-js/example/playback-locations/
    mapboxgl.accessToken = 'pk.eyJ1IjoiZG9tbGV0IiwiYSI6ImNtYXNmd3pkejBtbzMycnB5Z2lxeHV3emoifQ.2eHmSbQvmm9wTT344pyrRQ';
    const map = new mapboxgl.Map({
      container: 'map',
      // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
      style: 'mapbox://styles/mapbox/outdoors-v12',
      center: [-122.193313, 37.761248],
      zoom: 17.87,
      minZoom: 9,
      bearing: 0.00,
      pitch: 45.00
    });

    const title = document.getElementById('location-title');
    const description = document.getElementById('location-description');
    const landmarks = document.getElementById('landmarks');

    const locations = [
      {
        'id': '1',
        'title': 'Day 1: Bike the Golden Gate Bridge',
        'landmarks': 'Points of Interest: Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "An adventurous first day! From Montgomery BART (SF), we will take MUNI #30 bus to Sports Basement (Presidio). There, we will pick up our bikes, locks, and helmets.",
        'camera': {

          center: [-122.46302, 37.81783],
          zoom: 13,
          bearing: -14.4,
          pitch: 55
        }
      },
      {
        'id': '2',
        'title': 'Day 2: Bike Angel Island',
        'landmarks': 'Points of Interest: Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "An historic island with abandoned military forts from the Civil War era, and abandoned immigration detention facilities with a history of Chinese exclusion.",
        'camera': {
          center: [-122.43429, 37.86285],
          bearing: 0,
          zoom: 14,
          pitch: 47
        }
      },
      {
        'id': '3',
        'title': 'Bike the Great Highway',
        'landmarks': 'Points of Interest: Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          'Even if you think you know Manhattan—its world-class museums, fine dining and unforgettable views—the borough always has something new and exciting in store.',
        'camera': {
          center: [-122.47732, 37.76665],
          pitch: 45,
          zoom: 1
        }
      },
      {
        'id': '4',
        'title': 'Day 4: Bike the Bay Trail (EB)',
        'landmarks': 'Points of Interest: Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "Taste food from around the globe, watch Mets baseball and US Open tennis, see cutting-edge art and more in one of the world's most diverse places.",
        'camera': {
          center: [-73.8432, 40.6923],
          bearing: 36,
          zoom: 11.37
        }
      },
      {
        'id': '5',
        'title': 'Day 5: Return Bikes & Dim Sum',
        'landmarks': 'Points of Interest: Starbucks (Estuary Cove), Brooklyn Basin, Oakland Ferry Terminal, Sports Basement Presidio, Washington Square Park, Portsmouth Square, Hang Ah Dim Sum',
        'description':
          'On our last day, we will bike from CCPA to the Oakland Ferry Terminal, and take the ferry to SF. We will ride to the Presidio and return our bikes at Sports Basement. Then, we will take a bus to North Beach (Washington Square Park) and walk to Chinatown, which is an adjacent neighborhood. We will eat a Chinese Dim Sum lunch at Hang Ah Restaurant.',
        'camera': {
          center: [-74.1991, 40.5441],
          bearing: 28.4,
          zoom: 11.64
        }
      }
    ];

    function highlightBorough(code) {
      // Only show the polygon feature that corresponds to `borocode` in the data.
      map.setFilter('highlight', ['==', 'borocode', code]);
    }

    function nextDay() {
      index = (index + 1) % locations.length;
      playback(index);
      console.log(index);
    }
    function playback(index) {
      title.textContent = locations[index].title;
      description.textContent = locations[index].description;
      landmarks.textContent = locations[index].landmarks;

      // highlightBorough(locations[index].id ? locations[index].id : '');

      // Animate the map position based on camera properties.
      map.flyTo(locations[index].camera);
    }

    // Display the last title/description first.
    title.textContent = locations[locations.length - 1].title;
    description.textContent = locations[locations.length - 1].description;
    landmarks.textContent = locations[locations.length - 1].landmarks;


    map.on('load', () => {
      map.addSource('day01', {
        type: 'geojson',
        data: 'day01.geojson'
      });
      map.addLayer({
        id: 'day01',
        source: 'day01',
        type: 'line',
        "paint": {
          "line-color": "blue",
          "line-width": 5,
          "line-dasharray": [1, 1]
        }
      });
      map.addSource('day02', {
        type: 'geojson',
        data: 'day02.geojson'
      });
      map.addLayer({
        id: 'day02',
        source: 'day02',
        type: 'line',
        "paint": {
          "line-color": "blue",
          "line-width": 5,
          "line-dasharray": [1, 1]
        }
      });
      // https://docs.mapbox.com/mapbox-gl-js/example/add-terrain/
      map.addSource('mapbox-dem', {
        'type': 'raster-dem',
        'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
        'tileSize': 512,
        'maxzoom': 14
      });
      map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 2.5 });
    });



    // Start the playback animation for each borough.
    index = 0
    playback(index);

  </script>

</body>

</html>