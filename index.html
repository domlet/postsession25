<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Play map locations as a slideshow</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <style>
    .map-overlay-container {
      position: absolute;
      width: 25%;
      top: 0;
      left: 0;
      padding: 10px;
      z-index: 1;
    }

    .map-overlay {
      font:
        12px/20px 'Helvetica Neue',
        Arial,
        Helvetica,
        sans-serif;
      background-color: #fff;
      border-radius: 3px;
      padding: 10px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .map-overlay h2,
    .map-overlay p {
      margin: 0 0 10px;
    }
  </style>

  <div id="map"></div>

  <div class="map-overlay-container">
    <div class="map-overlay">
      <h1 id="day"></h1>
      <h2 id="location-title"></h2>
      <h3 id="landmarks"></h3>
      <p id="location-description"></p>
      <button onclick="nextDay(index)">Next Day</button><br />
      <small><a target="_blank" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTNw0e583X1cRLA4AZ16hERlCQ80CRZxfdx6vnaCN4kbLwWOxMPM4ZCv8f8xMjNDImd-IcPwE5bEGCN/pubhtml?gid=624153727&single=true">View full itinerary</a></small>
    </div>
  </div>

  <script>

    /*
    Default map position
17.87



    */
    // Based on example: https://docs.mapbox.com/mapbox-gl-js/example/playback-locations/
    mapboxgl.accessToken = 'pk.eyJ1IjoiZG9tbGV0IiwiYSI6ImNtYXNmd3pkejBtbzMycnB5Z2lxeHV3emoifQ.2eHmSbQvmm9wTT344pyrRQ';
    const map = new mapboxgl.Map({
      container: 'map',
      // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
      style: 'mapbox://styles/mapbox/outdoors-v12',
      center: [-122.193313, 37.761248],
      zoom: 17.87,
      minZoom: 9,
      bearing: 0.00,
      pitch: 45.00
    });

    const day = document.getElementById('day');
    const title = document.getElementById('location-title');
    const description = document.getElementById('location-description');
    const landmarks = document.getElementById('landmarks');

    const locations = [
      {
        'id': '2',
        'day': 'Day 1 (May 20th)',
        'title': 'Bike the Golden Gate Bridge',
        'landmarks': 'Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "An adventurous first day! From Montgomery BART (SF), we will take MUNI #30 bus to Sports Basement (Presidio). There, we will pick up our bikes, locks, and helmets.",
        'camera': {

          center: [-122.46302, 37.81783],
          zoom: 13,
          bearing: -14.4,
          pitch: 55
        }
      },
      {
        'id': '3',
        'day': 'Day 1 (May 20th)',
        'title': 'Day 2: Bike Angel Island',
        'landmarks': 'Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "An historic island with abandoned military forts from the Civil War era, and abandoned immigration detention facilities with a history of Chinese exclusion.",
        'camera': {
          center: [-122.43429, 37.86285],
          bearing: 0,
          zoom: 14,
          pitch: 47
        }
      },
      {
        'id': '1',
        'day': 'Day 1 (May 20th)',
        'title': 'Day 3: Bike the Great Highway',
        'landmarks': 'Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          'Even if you think you know Manhattan—its world-class museums, fine dining and unforgettable views—the borough always has something new and exciting in store.',
        'camera': {
          center: [-74.007, 40.7437],
          bearing: 25.3,
          zoom: 11.5
        }
      },
      {
        'id': '4',
        'day': 'Day 1 (May 20th)',
        'title': 'Day 4: Bike the Bay Trail (EB)',
        'landmarks': 'Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          "Taste food from around the globe, watch Mets baseball and US Open tennis, see cutting-edge art and more in one of the world's most diverse places.",
        'camera': {
          center: [-73.8432, 40.6923],
          bearing: 36,
          zoom: 11.37
        }
      },
      {
        'id': '5',
        'day': 'Day 1 (May 20th)',
        'title': 'Day 5: Return Bikes & Dim Sum',
        'landmarks': 'Sports Basement Presidio, Crissy Field, Palace of Fine Arts, Golden Gate Bridge, Vista Point, Montgomery BART',
        'description':
          'Take a free ferry ride to an island getaway filled with historic architecture, stunning views, gardens and many family-friendly attractions.',
        'camera': {
          center: [-74.1991, 40.5441],
          bearing: 28.4,
          zoom: 11.64
        }
      }
    ];

    function highlightBorough(code) {
      // Only show the polygon feature that corresponds to `borocode` in the data.
      map.setFilter('highlight', ['==', 'borocode', code]);
    }

    function nextDay(index) {
      index = (index + 1) % locations.length;
      playback(index);
    }
    function playback(index) {

      // add routes (begin)
      // Define a source before using it to create a new layer
      if (index == 0) {
        map.addSource('day01', {
          type: 'geojson',
          data: 'day01.geojson'
        });
        map.addLayer({
          id: 'day01',
          source: 'day01',
          type: 'line',
          "paint": {
            "line-color": "blue",
            "line-width": 5,
            "line-dasharray": [1, 1]
          }
        });
      } else if (index == 1) {
        map.addSource('day02', {
          type: 'geojson',
          data: 'day02.geojson'
        });
        map.addLayer({
          id: 'day02',
          source: 'day02',
          type: 'line',
          "paint": {
            "line-color": "blue",
            "line-width": 5,
            "line-dasharray": [1, 1]
          }
        });

      }
      // add routes (end)


      day.textContent = locations[index].day;
      title.textContent = locations[index].title;
      description.textContent = locations[index].description;
      landmarks.textContent = locations[index].landmarks;

      highlightBorough(locations[index].id ? locations[index].id : '');

      // Animate the map position based on camera properties.
      map.flyTo(locations[index].camera);
    }

    // Display the last title/description first.
    day.textContent = locations[locations.length - 1].day;
    title.textContent = locations[locations.length - 1].title;
    description.textContent = locations[locations.length - 1].description;
    landmarks.textContent = locations[locations.length - 1].landmarks;


    map.on('load', () => {
      map.addSource('boroughs', {
        'type': 'vector',
        'url': 'mapbox://mapbox.8ibmsn6u'
      });
      map.addLayer(
        {
          'id': 'highlight',
          'type': 'fill',
          'source': 'boroughs',
          'source-layer': 'original',
          'paint': {
            'fill-color': '#fd6b50',
            'fill-opacity': 0.25
          },
          'filter': ['==', 'borocode', '']
        },
        'road-label' // Place polygon under labels.
      );

      // Start the playback animation for each borough.
      index = 0
      playback(index);

      // https://docs.mapbox.com/mapbox-gl-js/example/add-terrain/
      map.addSource('mapbox-dem', {
        'type': 'raster-dem',
        'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
        'tileSize': 512,
        'maxzoom': 14
      });
      map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 2.5 });
    });
  </script>

</body>

</html>